### **گزارش کار**  
**تاریخ:** 1403/12/19  
**نام:** امیرمحمد شریفی  


### **گزارش کار: تشخیص ناهنجاری در داده‌های کمپرسور با استفاده از مدل ONNX**

---

#### **1. مقدمه**
در این پروژه، هدف تشخیص ناهنجاری (Anomaly Detection) در داده‌های عملکرد یک کمپرسور صنعتی است. برای این منظور، از یک مدل یادگیری ماشین آموزش‌دیده (Isolation Forest) که به فرمت ONNX ذخیره شده است، استفاده می‌شود. این مدل بر روی داده‌های ورودی شامل پارامترهای مختلفی مانند فشار، دما، رطوبت، ارتعاش و غیره آموزش دیده است. در ادامه، فرآیند کار و نحوه پیاده‌سازی API برای تشخیص ناهنجاری توضیح داده می‌شود.

---

#### **2. داده‌ها**
داده‌های استفاده‌شده در این پروژه از فایل CSV خوانده شده‌اند. این داده‌ها شامل 100,000 ردیف و 18 ستون هستند که هر ردیف نشان‌دهنده وضعیت کمپرسور در یک زمان مشخص است. ستون‌های اصلی داده‌ها عبارتند از:

- **Timestamp:** زمان ثبت داده.
- **Pressure_In, Pressure_Out:** فشار ورودی و خروجی.
- **Temperature_In, Temperature_Out:** دمای ورودی و خروجی.
- **Flow_Rate:** نرخ جریان.
- **Efficiency:** راندمان کمپرسور.
- **Power_Consumption:** مصرف انرژی.
- **Vibration:** ارتعاش.
- **Ambient_Temperature, Humidity, Air_Pollution:** شرایط محیطی.
- **Startup_Shutdown_Cycles, Maintenance_Quality, Fuel_Quality, Load_Factor:** پارامترهای عملیاتی.

---

#### **3. پیش‌پردازش داده‌ها**
برای آماده‌سازی داده‌ها برای مدل، مراحل زیر انجام شده است:

1. **حذف ستون‌های غیرضروری:**
   - ستون `Status` حذف شده است، زیرا تنها برچسب‌های طبقه‌بندی را نشان می‌دهد.
   - ستون `Time` نیز حذف شده است، زیرا زمان به صورت عددی قابل استفاده در مدل نیست.

2. **استانداردسازی داده‌ها:**
   - داده‌ها با استفاده از روش استانداردسازی به مقیاس یکسان تبدیل شده‌اند. این کار باعث می‌شود که تمام ویژگی‌ها به یک مقیاس مشابه برسند.

3. **فیلتر کردن داده‌ها با فیلتر کالمن:**
   - برای کاهش نویز و بهبود کیفیت داده‌ها، از فیلتر کالمن استفاده شده است. این فیلتر داده‌ها را صاف کرده و نویزهای تصادفی را کاهش می‌دهد.

---

#### **4. مدل ONNX**
مدل استفاده‌شده برای تشخیص ناهنجاری یک مدل Isolation Forest است که به فرمت ONNX ذخیره شده است. این مدل به صورت پیش‌فرض برای تشخیص نقاط دورافتاده (Outliers) طراحی شده است. مدل در فایل `isolation_forest_model.onnx` ذخیره شده و در API مورد استفاده قرار می‌گیرد.

---

#### **5. پیاده‌سازی API**
برای ارائه سرویس تشخیص ناهنجاری، یک API پیاده‌سازی شده است. این API شامل مسیر `/detect_anomaly` است که با متد `GET` قابل دسترسی است. در ادامه، مراحل اجرای این API توضیح داده می‌شود:

##### **الف) مسیر API**
این مسیر برای دریافت آخرین داده‌ها از دیتابیس و تشخیص ناهنجاری استفاده می‌شود.

##### **ب) بارگذاری مدل**
مدل ONNX از مسیر مشخص‌شده بارگذاری می‌شود. شیء `AnomalyDetector` ایجاد می‌شود که شامل متدهایی برای اتصال به دیتابیس، استانداردسازی داده‌ها و اجرای مدل است.

##### **ج) تشخیص ناهنجاری**
آخرین داده‌ها از دیتابیس خوانده می‌شوند. داده‌ها استانداردسازی شده و به مدل ONNX داده می‌شوند. امتیاز ناهنجاری محاسبه می‌شود و اگر بیشتر از آستانه (0.5) باشد، وضعیت به عنوان ناهنجاری شناسایی می‌شود.

##### **د) بازگرداندن نتیجه**
نتیجه تشخیص ناهنجاری (`Normal Operation` یا `Anomaly Detected`) به صورت JSON بازگردانده می‌شود.

##### **ه) مدیریت خطاها**
اگر خطایی در فرآیند تشخیص ناهنجاری رخ دهد، پیام خطا به همراه کد وضعیت HTTP `500 Internal Server Error` بازگردانده می‌شود.

---

#### **6. نتایج**
با اجرای API و فراخوانی مسیر `/detect_anomaly`، نتایج زیر قابل دریافت هستند:

- **در صورت موفقیت:**
  ```json
  {
      "status": "Normal Operation"
  }
  ```

- **در صورت بروز خطا:**
  ```json
  {
      "error": "Anomaly detection failed: [ONNXRuntimeError] ..."
  }
  ```

---

#### **7. نتیجه‌گیری**
این پروژه نشان می‌دهد که چگونه می‌توان از مدل‌های یادگیری ماشین برای تشخیص ناهنجاری در داده‌های صنعتی استفاده کرد. با استفاده از API پیاده‌سازی‌شده، می‌توان وضعیت کمپرسور را به صورت بلادرنگ بررسی کرد و در صورت بروز ناهنجاری، اقدامات لازم را انجام داد. این رویکرد می‌تواند به بهبود عملکرد و کاهش هزینه‌های نگهداری کمک کند.

---

#### **8. پیشنهادات**
1. **بهبود مدیریت استثناها:**
   - خطاهای مختلف (مثل عدم اتصال به دیتابیس، خطا در بارگذاری مدل) را به طور جداگانه مدیریت کنید.

2. **تنظیم آستانه:**
   - مقدار آستانه (`threshold`) را می‌توانید به عنوان پارامتر ورودی API در نظر بگیرید.

3. **ثبت نتایج در دیتابیس:**
   - نتایج تشخیص ناهنجاری را در یک جدول دیتابیس ذخیره کنید تا قابل تحلیل باشند.

4. **اعتبارسنجی ورودی‌ها:**
   - اگر پارامترهای ورودی (مثل `threshold`) از کاربر دریافت می‌شوند، اعتبارسنجی آنها را انجام دهید.

---

**پاسخ نهایی:**  
**گزارش کار شامل مراحل پیش‌پردازش داده‌ها، بارگذاری مدل ONNX، پیاده‌سازی API و نتایج حاصل از تشخیص ناهنجاری است. این پروژه نشان می‌دهد که چگونه می‌توان از مدل‌های یادگیری ماشین برای تشخیص ناهنجاری در داده‌های صنعتی استفاده کرد.**